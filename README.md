# Tracr

## Introduction

**Tracr** is a brand new command-line interface (CLI) tool for Node.js projects, designed to provide non-intrusive profiling and debugging by instrumenting code at runtime to trace performance, errors, data flow, and other key events. This tool is ideal for developers who need to diagnose issues and optimize Node.js applications.

---

## Table of Contents

- [Purpose](#purpose)
- [Scope](#scope)
- [Definitions and Acronyms](#definitions-and-acronyms)
- [Project Structure](#project-structure)
- [Getting Started](#getting-started)
- [Contributing Guide](#contributing-guide)
- [Features To Build](#features-to-build)
- [Commands](#proposed-commands)
- [System Requirements](#system-requirements)
- [Contact](#contact)

---

## Purpose

This document outlines the requirements and initial developer onboarding for Tracr. The goal is to build a globally installable npm package that enables runtime tracing for Node.js applications with zero modification to the user's source files.

---

## Scope

- Node.js CLI tool for profiling/debugging.
- Works with CommonJS and ES Modules.
- Multiple tracing modes: full-project, focused via config, targeted via in-code comments, non-intrusive.
- Output: terminal or local web-based GUI.

---

## Definitions and Acronyms

| Term          | Definition                                                                                   |
|---------------|---------------------------------------------------------------------------------------------|
| CLI           | Command-Line Interface                                                                      |
| AST           | Abstract Syntax Tree: A tree representation of the syntactic structure of source code.      |
| Instrumentation| Adding code to monitor behavior without changing logic.                                    |
| Monkey-Patching| Dynamic modification at runtime.                                                           |
| Checkpoint    | High-level unit of work to be traced (function/class method).                               |
| Sub-checkpoint| Low-level event within a checkpoint (variable assignment, if block, etc.).                  |

---

## Project Structure

```
tracr/
├── bin/
│   └── tracr          # CLI entry point
├── src/
│   ├── ast/           # AST parsing/instrumentation logic
│   ├── tracing/       # Tracing/event bus logic
│   ├── output/        # Terminal and Web UI output logic
│   ├── config/        # tracr.config.js management
│   └── utils/         # Utility functions
├── tracr.config.js    # Sample config file (generated by `tracr init`)
├── package.json
└── README.md
```

---

## Getting Started

1. **Clone the Repo**
    ```sh
    git clone https://github.com/savive/tracr.git
    cd tracr
    ```

2. **Install Dependencies**
    ```sh
    pnpm install
    ```

3. **Run the CLI (dev mode)**
    ```sh
    node bin/tracr
    ```

4. **Try Basic Command**
    ```sh
    pnpm link     # Optional: To run as global CLI
    tracr --help
    ```

---

## Contributing Guide

### 1. Understand the Requirements

Read this README and the requirements below. Tracr aims for **non-intrusive, AST-based instrumentation** and real-time tracing.

### 2. Pick a Feature or Area

Check [Features To Build](#features-to-build) and [Proposed Commands](#proposed-commands). Open issues for any new ideas.

### 3. Follow the Development Path

#### Suggested Path for Early Contributors:

- **CLI Bootstrapping:** Expand the CLI entry point in `bin/tracr` using [commander](https://www.npmjs.com/package/commander) for command parsing.
- **AST Instrumentation:** Research and implement AST parsing (consider tools like [acorn](https://github.com/acornjs/acorn)/[babel](https://babeljs.io/)). Build a module in `src/ast/` to inject tracers.
- **Config Management:** Implement reading and validating `tracr.config.js` in `src/config/`.
- **Tracing/Event Bus:** Create an event bus in `src/tracing/` that receives and logs events from instrumented code.
- **Terminal Output:** Develop a color-coded, hierarchical trace logger in `src/output/`.
- **Web UI:** Scaffold a simple local web server with [express](https://expressjs.com/) and [socket.io](https://socket.io/) for live trace data.
- **Testing:** Use [jest](https://jestjs.io/) for unit tests and [eslint](https://eslint.org/) for code linting.

#### What To Avoid

- Directly modifying user code files.
- External telemetry or cloud data submission.

#### Best Practices

- Write clear, maintainable code.
- Document functions and modules.
- Handle errors gracefully.
- Discuss major changes via issues or pull requests.

---

## Features To Build

- [ ] **Instrumentation Modes:** Config, Default, Comment-Based, No-Instrumentation
- [ ] **AST-Based Instrumentation:** Accurate checkpoint and sub-checkpoint tracing
- [ ] **Event Bus:** Central event emitter for trace events
- [ ] **Terminal Output:** Hierarchical, color-coded trace
- [ ] **Web UI Output:** Optional local server for GUI
- [ ] **Config File Support:** `tracr.config.js`
- [ ] **Non-Intrusive Mode:** Runs app without code changes
- [ ] **Module Tracing:** Recursively trace all dependencies except `node_modules`
- [ ] **Filtering:** Regex-based filtering for traces
- [ ] **Time Thresholds:** Highlight slow functions
- [ ] **Init Command:** Scaffold a config file

---

## Proposed Commands

| Command                         | Description                                             |
|----------------------------------|---------------------------------------------------------|
| `tracr -c`, `--config`          | Run instrumentation based on `tracr.config.js`          |
| `tracr -d`, `--default`         | Full, default instrumentation of the entire app         |
| `tracr`                         | Scans for comments or config; defaults to passive mode  |
| `tracr --host <port>`           | Starts web server for UI output                         |
| `tracr init`                    | Creates a sample `tracr.config.js`                      |
| `tracr --help`, `-h`            | Displays help information                               |
| `tracr --filter <regex>`        | Filters trace output                                    |
| `tracr --time <threshold>`      | Displays functions exceeding execution time             |

---

## System Requirements

- **OS:** Windows, macOS, Linux
- **Node.js:** v14 or higher
- **Interface:** CLI, local web server (optional)
- **Dependencies:** See `package.json` (start with `commander`, add more as needed)

---

## Contact

Feel free to open issues or pull requests for questions, feedback, or feature requests.

- **Repository:** [github.com/savive/tracr](https://github.com/savive/tracr)
- **Issue Tracker:** [github.com/savive/tracr/issues](https://github.com/savive/tracr/issues)

---

## License

MIT